## 一、前端三方依赖
### 1. 百度地图JS API

#### 1. API文档
https://lbsyun.baidu.com/cms/jsapi/reference/jsapi_reference_3_0.html#a1b2

#### 2. 依赖的接口能力
- 百度地图JS API的geocoder模块，用于将地址转换为经纬度坐标
- 百度地图JS API的map模块，用于展示地图和标记点
- 百度地图JS API的route模块，用于展示路线
- 百度地图JS API的marker模块，用于展示标记点，同时标记点添加跳动效果

```javascript

// 加载百度地图脚本
const loadScript = () => {
    const script = document.createElement("script");
    script.src = "https://api.map.baidu.com/api?v=3.0&ak=EXl1klVct9z0GXE7KAkPUkawwDhDN0h9&callback=initMap";
    document.body.appendChild(script);
};
// 示例代码
// 初始化地图
var map = new BMap.Map("map");
// 初始化地图中心点
map.centerAndZoom(new BMap.Point(118.148154, 24.497912), 15);
// 打开信息窗口
map.openInfoWindow(infoWindow, new BMap.Point(loopList[i].point.lng, loopList[i].point.lat));
// 地图缩放动画
map.setCenter(point);
map.setZoom(toZoom);
// 添加弹跳标记
marker = new BMap.Marker(coords);
map.addOverlay(marker);
marker.setAnimation(BMAP_ANIMATION_BOUNCE);
```
### 2. H5音频播放
- 页面需要支持H5音频播放， 可以使用HTML5的audio标签，兼容移动端
- 配置文件中需要包含音频文件的URL， 页面在加载完成后， 会自动播放音频


## 二、配置文件示例
### 1. type枚举值说明:
- 1:代表顺序展示地点位置，locations每个展示后增加标记弹跳效果
- 2:代表展示两个地方之间的路线， 限制locations数组有且只有两个地点，绘制路线并展示
- 3:代表展示一起去过的地方，顺序展示每location位置，不用标记点弹跳效果

### 2. address相关字段说明:
详细地址描述，用于转换为经纬度坐标，等后续配置化用的，页面展示效果用不到这个字段

### 3. point相关字段说明:
使用的是百度地图的经纬度坐标， 包含以下字段:
- lng: 经度
- lat: 纬度

### 4. 配置示例
 
```json
{
    "basic_cfg": {
        "initMapCenterAddress": "广东省深圳市",
        "initMapCenterPoint": {
            "lng": 118.148154,
            "lat": 24.497912
        },
        "audioUrl": "https://img.xxx.com/20230323/xx.mp3"
    },
    "showList": [
        {
            "order": 1,
            "type": 1,
            "typeDesc": "1代表顺序展示地点位置，locations每个展示后增加标记弹跳效果",
            "startAddress": "本节展示开始时的地图中心点地址，如果广东省深圳市宝体地铁站",
            "startPoint": {
                "lng": 118.148154,
                "lat": 24.497912
            },
            "chapterName": "双方位置",
            "locations": [
                {
                    "showText": "小明",
                    "showType": 1,
                    "showImgUrl": "https://img.xx.com/20230323/xx.png",
                    "address": "省市区地址",
                    "point": {
                        "lng": 118.148154,
                        "lat": 24.497912
                    }
                }
            ]
        }
    ],

    "endShowCfg": {
        "endMapCenterAddress": "甘肃省兰州市",
        "endMapCenterPoint":{
            "lng": 118.148154,
            "lat": 24.497912
        }
        "markerList": [
            {
                "lng": 118.148154,
                "lat": 24.497912
            },
            {
                "lng": 118.148154,
                "lat": 24.497912
            }
        ]
    }
}
```

## 三、页面展示效果

### 1. 页面初始化
- 1. 加载依赖的js文件， 包括百度地图api， 以及自定义的js文件
- 2. 异步请求后端接口，获取config.json(暂时不做，请求方法mock返回配置的json字符串)
- 3. 提取json中所有的showImgUrl， 并预加载这些图片
- 4. 初始化H5音频，注意要兼容移动端
- 5. 初始化地图组件， 居中显示initMapCenterAddress， 缩放级别为15
- 6. 加载完毕，页面居中展示 点击开始按钮

### 2. 点击开始按钮触发事件
- 1. 地图全屏展示（占满整个屏幕，兼容移动端特别是微信内）， 居中显示initMapCenterAddress， 缩放级别为15
- 2. 开始播放音乐， 注意要兼容移动端
- 3. 遍历showList， 顺序处理这个数组中的每组数据

### 3. 处理showList中的每组数据-顺序执行
先根据该组startPoint重置地图，然后读取该组展示章节数据locations， 先判断该组数据的展示类型，根据type区分
- 1:代表顺序展示地点位置，展示每个locations后增加标记弹跳效果
- 2:代表展示两个地方之间的路线， 此时locations数组有且只有两个地点，标记完地点后，绘制两个地点直接的驾车路线并展示
- 3:代表展示一起去过的地方，顺序展示每location位置，不用标记点弹跳效果，若文案或者图片不为空，在标记地点上方展示文案和图片

### 4. showList处理结束后，读取endShowCfg
地图定位到endMapCenterPoint， 缩放级别为卫星图， 并打乱markerList数组排序，然后顺序展示endShowCfg中的markerList标记点，这些点形成的图形是一句话

### 5. 结束页面
上面所有动画执行完毕后，出现一个下拉闭幕效果， 然后屏幕中间出现， 再看一次按钮。


## 四、重构要求
### 1. 暂时不做后端，配置json先在代码里面请求方法直接写死返回
### 2. 要兼容移动端， 包括微信内
### 3. 只依赖必要的js文件， 包括百度地图api
### 4. 代码流程必须清晰，特别是关于顺序执行控制部分（各种回调处理）， 包括注释，方便修改

